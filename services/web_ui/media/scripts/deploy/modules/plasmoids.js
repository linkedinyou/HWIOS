require.def("modules/plasmoids",[],function(){function unbind_events(){$(document).unbind("infinote_update"),$("#id_auto_preview").die()}function bind_events(){function try_run_plasmoid(){try{eval(editor._state.buffer.toString())}catch(error){console.log(error)}}$("#id_auto_preview").live("click",function(){$(this).attr("checked")=="checked"?$("#id_type").val()==1&&(try_run_plasmoid(),$(document).unbind("infinote_update").bind("infinote_update",function(a){delete application.plasmoids[$("#uuid").val()],$(".plasmoid-preview").empty(),try_run_plasmoid()})):($(document).unbind("infinote_update"),delete application.plasmoids[$("#uuid").val()],$(".plasmoid-preview").empty())}),$(document).bind("infinote_synced",function(a,b,c,d){editor===undefined})}function bind_ws(){application.ws.method("^/data/plasmoids/(?<plasmoid_uuid>[^/]+)/online/update/$",function(a){editor.update_online(a.online)}),application.ws.method("^/plasmoids/modified/$",function(a){application.functions.plasmoids.view_plasmoids(a,!0)})}function bind_functions(){application.functions.plasmoids={route:function(a,b){urls==undefined&&(urls=[[XRegExp("^/plasmoids/$"),this.view_plasmoids],[XRegExp("^/plasmoids/new/$"),this.create_plasmoid],[XRegExp("^/plasmoids/(?<uuid>[^/]+)/edit/$"),this.edit_plasmoid]]),application.route_uri_to_mod_function(a,urls,b)},view_plasmoids:function(a,b){b==undefined?application.ws.remote("/plasmoids/",{},function(a){application.functions.ui.transition(a.data.dom.main,$(".main"))}):application.functions.ui.transition(a.data.dom.main,$(".main"))},delete_plasmoids:function(){application.ws.remote("/data/plasmoids/delete/",{},function(a){i18nButtons={},i18nButtons[gettext("Cancel")]=function(){$(this).dialog("close")},i18nButtons[gettext("Delete")]=function(){var a=$(".datatable :checkbox:checked:visible").serializeObject();application.ws.remote("/data/plasmoids/delete/",{params:a},function(a){application.cb_selected=0,application.functions.ui.transition(a.data.dom.main,$(".main")),$(".datatable").dataTable({bJQueryUI:!0,bAutoWidth:!1,aoColumnDefs:[{aTargets:[0],bSearchable:!1,bSortable:!1}]}),$tabs=$("#simulation_tabs").tabs()}),$(this).dialog("close")},$deletePlasmoid=$(a.data.dom.dialog).dialog({resizable:!1,width:300,modal:!0,title:'<span class="ui-icon ui-icon-arrow-4-diag"></span><span>'+gettext("Please confirm")+"...</span>",open:function(a,b){$(".confirm-list").html(get_cb_names())},buttons:i18nButtons})})},create_plasmoid:function(){application.ws.remote("/plasmoids/new/",{},function(a){initEditor(a.data.plasmoid.uuid,a.data.dom.main)})},edit_plasmoid:function(a){initEditor(a.uuid)},cancel_edit_plasmoid:function(){listPlasmoids()},save_plasmoid:function(a){var b=$("form:visible").serializeObject();b.content=editor._state.buffer.toString(),application.ws.remote("/data/plasmoids/"+a.uuid+"/save/",{form:b},function(b){switch(b.status.code){case"PLASMOID_EDIT_OK":application.functions.plasmoids.view_plasmoids();break;case"PLASMOID_EDIT_NO_CHANGE":application.functions.plasmoids.view_plasmoids();break;case"FORM_INVALID":initEditor(a.uuid,b.data.dom.main)}})}}}function initEditor(a,b){editor=$.jinfinote(application.ws,{ws_connect:"/plasmoids/"+a+"/edit/",ws_disconnect:"/data/plasmoids/"+a+"/disconnect/",ws_insert:"/data/plasmoids/"+a+"/insert/",ws_delete:"/data/plasmoids/"+a+"/remove/",ws_undo:"/data/plasmoids/"+a+"/undo/",ws_caret:"/data/plasmoids/"+a+"/caret/",cb_insert:"^/data/plasmoids/(?<plasmoid_uuid>[^/]+)/insert/$",cb_delete:"^/data/plasmoids/(?<plasmoid_uuid>[^/]+)/remove/$",cb_undo:"^/data/plasmoids/(?<plasmoid_uuid>[^/]+)/undo/$",cb_caret:"^/data/plasmoids/(?<plasmoid_uuid>[^/]+)/caret/$",mode:"javascript",init:function(c){typeof b=="undefined"?application.functions.ui.transition(c.dom.main,$(".main")):(application.functions.ui.transition(b,$(".main")),$.each($(".main .errorlist"),function(){$(this).next().prepend('<span class="ui-icon ui-icon-info"></span>')})),canvas_preview=$("#plasmoid_"+a).get(0);return{editor_element:"#plasmoid-editor"}}})}function init_helpers(){$("#slider-shutdown-time").slider({animate:!0,min:1,max:60,value:5,change:function(a,b){$("#id_shutdown_time").val($("#slider-shutdown-time").slider("option","value")),$("#slider-shutdown-time-indicator").text(gettext("Reboot")+" ("+$("#slider-shutdown-time").slider("option","value")+" sec.)")}}),$("#id_shutdown_time").val($("#slider-shutdown-time").slider("option","value")),$("#slider-shutdown-time-indicator").text(gettext("Reboot")+" ("+$("#slider-shutdown-time").slider("option","value")+" sec.)")}function get_cb_names(){var a="<ul>";$.each($(".datatable :checkbox:checked:visible"),function(b,c){var d=$(this).parent().next().text();d!=""?a=a+"<li>"+d+"</li>":a=a+"<li>Unnamed - "+$(this).parent().next().next().text()+"</li>"}),a+="</ul>";return a}var editor,plasmoid_uuid,canvas_preview,processing,urls;return{init:function(a,b){bind_functions(),bind_ws(),bind_events(),application.functions.plasmoids.route(a,b);return"plasmoids"},load:function(a,b){bind_events(),application.functions.plasmoids.route(a,b)},clean_up:function(){unbind_events()}}})