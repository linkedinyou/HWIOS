(function(){function b(b){var c=b.currentTarget||b.srcElement,i;if(b.type==="load"||d.test(c.readyState)){b=c.getAttribute("data-requiremodule"),f[b]=!0;for(b=0;i=e[b];b++)if(f[i.name])a(i.name,i.req,i.onLoad);else break;b>0&&e.splice(0,b),setTimeout(function(){c.parentNode.removeChild(c)},15)}}function a(a,b,c){b([a],function(a){c(function(){return a})})}var c=typeof document!=="undefined"&&typeof window!=="undefined"&&(document.createElement("script").async||window.opera&&Object.prototype.toString.call(window.opera)==="[object Opera]"||"MozAppearance"in document.documentElement.style),d=/^(complete|loaded)$/,e=[],f={};define("order",{version:"0.24.0",load:function(d,f,h,i){var k=f.nameToUrl(d,null);i.isBuild?a(d,f,h):(require.s.skipAsync[k]=!0,c?f([d],function(a){h(function(){return a})}):f.isDefined(d)?f([d],function(a){h(function(){return a})}):(e.push({name:d,req:f,onLoad:h}),require.attach(k,"",d,b,"script/cache")))}})})(),jQuery.color||function(a){a.color={isEqual:function(a,b){if(a.length!==b.length)return!1;var c=a.length;while(c--)if(a[c]!==b[c])return!1;return!0},fix:function(a,b){var c=b.length;while(c--)if(typeof a[c]==="number")switch(b.charAt(c)){case"i":a[c]=Math.round(a[c]);break;case"o":a[c]=Math.min(255,Math.max(0,Math.round(a[c])));break;case"1":a[c]=Math.min(1,Math.max(0,a[c]))}return a},self:function(a){return a},alpha:function(a){return a===undefined?1:a},palette:{},fns:[]}}(jQuery),jQuery.color&&function(a){a.color.RGB={fix:function(b){b=a.color.fix(b,"ooo1");return b},toRGB:a.color.self,toHEX:function(a){return"#"+(16777216+a[0]*65536+a[1]*256+a[2]).toString(16).slice(-6)},toCSS:function(b){if(a.color.alpha(b[3])===0)return"transparent";if(a.color.alpha(b[3])<1)return"rgba("+b.join(",")+")";return"rgb("+Array.prototype.slice.call(b,0,3).join(",")+")"},red:function(a){return a[0]},green:function(a){return a[1]},blue:function(a){return a[2]},alpha:function(b){return a.color.alpha(b[3])}},a.color.RGB.toString=a.color.RGB.toHEX,a.color.fns.push("RGB.toRGB","RGB.toHEX","RGB.toCSS","RGB.red","RGB.green","RGB.blue","RGB.alpha")}(jQuery),jQuery.color&&function(a){a.color.HueBased={fix:function(b){b[0]=(b[0]+1)%1;return a.color.fix(b,"1111")},complementary:function(a,b){return[(a[0]+.5+(b||0))%1,a[1],a[2],a[3]]},analogous:function(a,b){return[(a[0]+1+(b||0))%1,a[1],a[2],a[3]]},hue:function(a){return a[0]},alpha:function(b){return a.color.alpha(b[3])}}}(jQuery),jQuery.color&&function(a){a.color.HSV=a.extend({toHSV:a.color.self,toRGB:function(a){var b=a[0]*6,c=Math.floor(b),d=b-c,e=a[1],f=a[2]*255,g=a[3],h=Math.round(f*(1-e)),i=Math.round(f*(1-d*e)),j=Math.round(f*(1-(1-d)*e));f=Math.round(f);switch(c%6){case 0:return[f,j,h,g];case 1:return[i,f,h,g];case 2:return[h,f,j,g];case 3:return[h,i,f,g];case 4:return[j,h,f,g];case 5:return[f,h,i,g]}},saturationV:function(a){return a[1]},value:function(a){return a[2]}},a.color.HueBased),a.color.RGB.toHSV=function(a){var b=a[0]/255,c=a[1]/255,d=a[2]/255,e=Math.min(b,c,d),f=Math.max(b,c,d),g=f-e;return[g===0?0:(c===f?(d-b)/g/6+1/3:d===f?(b-c)/g/6+2/3:(c-d)/g/6+1)%1,g===0?0:g/f,f,a[3]]},a.color.fns.push("HSV.toHSV","HSV.toRGB","RGB.toHSV","HSV.complementary","HSV.analogous","HSV.hue","HSV.saturationV","HSV.value","HSV.alpha")}(jQuery),jQuery.color&&function(a){a.color.HSL=a.extend({toHSL:a.color.self,toRGB:function(a){function g(a){var b=a<0?a+1:a>1?a-1:a;return b<1/6?f+(e-f)*6*b:b<.5?e:b<2/3?f+(e-f)*6*(2/3-b):f}var b=a[0],c=a[1],d=a[2],e=d<.5?d*(1+c):d+c-d*c,f=2*d-e;return[Math.round(255*g(b+1/3)),Math.round(255*g(b)),Math.round(255*g(b-1/3)),a[3]]},saturationL:function(a){return a[1]},lightness:function(a){return a[2]}},a.color.HueBased),a.color.RGB.toHSL=function(a){var b=a[0]/255,c=a[1]/255,d=a[2]/255,e=Math.min(b,c,d),f=Math.max(b,c,d),g=f-e,h=f+e;return[g===0?0:(c===f?(d-b)/g/6+1/3:d===f?(b-c)/g/6+2/3:(c-d)/g/6+1)%1,g===0?0:h>1?g/(2-f-e):g/h,h/2,a[3]]},a.color.fns.push("HSL.toHSL","HSL.toRGB","RGB.toHSL","HSL.complementary","HSL.analogous","HSL.hue","HSL.saturationL","HSL.lightness","HSL.alpha")}(jQuery),jQuery.color&&jQuery.Color||function(a){function e(){var b=this.split("."),c=b[1],e=b[0];!a.Color.fnspace[c]&&c!=="to"+e&&(a.Color.fnspace[c]=e),a.Color.fn[c]||(a.Color.fn[c]=d(this,c))}function d(b,d){var e=/^to/.test(d)?d.substring(2):!1;return function(){var b=this,g=b.util();g[d]||(b=b.to(a.Color.fnspace[d]),g=b.util());var i=c(b,g,g[d],e||b.space,!!e),j=i.apply(b,arguments);e?(this[d]=function(){return j},a.Color.isInstance(j)&&(b=this,j["to"+this.space]=function(){return b})):this[d]=i;return j}}function c(b,c,d,e,f){return function(){var k=[b];Array.prototype.push.apply(k,arguments);var l=d.apply(c,k);return a.isArray(l)?new a.Color(l,e,f?b.name:undefined):l}}function b(b,c){var d=a.Color.isInstance(b)&&b.space!==this.space?this.to(b.space):new a.Color(this),e=d.length,f=!1;while(e--)if(typeof b[e]==="number"){var g=c?d[e]+b[e]:b[e];g!==d[e]&&(d[e]=g,f=!0)}return f?d.setName():this}a.Color=function(b,c,d){if(typeof this==="function")return new a.Color(b,c,d);typeof b==="string"&&a.color.parse&&(d||(d=b),b=a.color.parse(b));if(b&&b.length){var e;e=this.length=b.length;while(e--)this[e]=b[e]}b&&(this.space=c||b.space||"RGB",this.name=d||b.name)},a.Color.fn=a.Color.prototype={color:"0.6",util:function(){return a.color[this.space]},to:function(a){return this["to"+a]()},fix:function(){return this.util().fix(this)},modify:function(a){return b.call(this,a)},adjust:function(a){return b.call(this,a,!0)},setName:function(a){this.name=a;return this},toString:function(){if(!this.space)return"";var a=this.util();return a.hasOwnProperty("toString")?a.toString(this):this.to("RGB").toString()},join:[].join,push:[].push},a.Color.isInstance=function(b){return b&&typeof b==="object"&&b.color===a.Color.fn.color&&b.space},a.Color.fnspace={},a.each(a.color.fns,e),a.color.fns.push=function(){a.each(arguments,e);return Array.prototype.push.apply(this,arguments)}}(jQuery),jQuery.color&&function(a){a.extend(a.color,{parse:function(b){var c;if(typeof b==="string"){if((c=/^\s*rgb(a)?\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*(?:,\s*([0-9]+(?:\.[0-9]+)?)\s*)?\)\s*$/.exec(b))&&!c[1]===!c[5])return[parseInt(c[2],10),parseInt(c[3],10),parseInt(c[4],10),c[5]?parseFloat(c[5]):1];if((c=/^\s*rgb(a)?\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*(?:,\s*([0-9]+(?:\.[0-9]+)?)\s*)?\)\s*$/.exec(b))&&!c[1]===!c[5])return[parseFloat(c[2])*255/100,parseFloat(c[3])*255/100,parseFloat(c[4])*255/100,c[5]?parseFloat(c[5]):1];if(c=/^\s*#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})\s*$/.exec(b))return[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16),1];if(c=/^\s*#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])\s*$/.exec(b))return[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16),1];if((c=/^\s*hsl(a)?\(\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*(?:,\s*([0-9]+(?:\.[0-9]+)?)\s*)?\)\s*$/.exec(b))&&!c[1]===!c[5])return[parseInt(c[2],10)/360,parseFloat(c[3])/100,parseFloat(c[4])/100,c[5]?parseFloat(c[5]):1];return a.color.named(b)}if(b&&(b.length===3||b.length===4)){b.length===3&&b.push(1);return b}},named:function(b){var c;b=a.trim(b.toLowerCase());if(b==="transparent")return[0,0,0,0];a.each(a.color.palette,function(a,d){if(d[b]){c=d[b];return!1}});return c}})}(jQuery),jQuery.Color&&function(a){a.Color.fn.related=function(b){var c=a.Color.fn.related.i18n,d=b||a.Color.fn.related.offset,e=Math.round(d*360)+c.deg;return{"anal-":this.analogous(-d).setName(c.anal+" -"+e),anal0:this.analogous().setName(c.orig),"anal+":this.analogous(d).setName(c.anal+" +"+e),"comp-":this.complementary(-d).setName(c.split+" -"+e),comp0:this.complementary().setName(c.comp),"comp+":this.complementary(d).setName(c.split+" +"+e),"triad-":this.analogous(-1/3).setName(c.triad+" -120"+c.deg),triad0:this.analogous().setName(c.orig),"triad+":this.analogous(1/3).setName(c.triad+" +120"+c.deg)}},a.Color.fn.related.offset=30/360,a.Color.fn.related.i18n={deg:"Â°",anal:"Analogous",orig:"Original",split:"Split Complementary",comp:"Complementary",triad:"Triadic"}}(jQuery),jQuery.color&&function(a){a.color.palette.css3={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}}(jQuery),function(a){a.fn.cssColor=function(b){return a.Color(this.css(b))},a.Color.fn.applyCSS=function(b,c){a(b).css(c,this.toCSS());return this}}(jQuery),define("lib/jquery/jquery.color",function(){}),function(a){function m(a){b=this,this.opts=a,this.layers=[],this._layer_index,this.worker=new Worker("/media/scripts/lib/jquery/jquery.cpaint.worker.js"),this.tmplog=[],this.fg_color,this.bg_color,this.tool="brush",this.tool_active=!1,this.prev_action,this.remote_prev_action,this.shape="rect",this.brushes=[new k,new l],this.brush=0,this.brush_size,this.font_size,this.text_line_width,this.bind_canvas_handlers()}var b,c,d,e=0,f,g=Class.extend({init:function(b){this.name=b,f.container.append('<canvas id="'+b+'-canvas"></canvas>'),this.jobject=a("#"+b+"-canvas"),this.element=this.jobject.get(0),this.element.width=f.container.width(),this.element.height=f.container.height(),this.ctx=this.element.getContext("2d")}}),h=Class.extend({init:function(){this.draw=!1,this.points=[],this.size,this.color,this._x1,this._x2,this._y1,this._y2,this.switch_x,this.switch_y},set_layer:function(a){this.layer=a},stroke:function(a,b,c,d,e){a>c?(this._x1=c,this._x2=a):(this._x1=a,this._x2=c),b>d?(this._y1=d,this._y2=b):(this._y1=b,this._y2=d)}}),k=h.extend({init:function(){this._super()},strokeStart:function(a,b,c){this.ctx=a.ctx,this.ctx.beginPath(),this.ctx.moveTo(b,c)},stroke:function(a,b,c,d,e,f){this.ctx.beginPath(),this.ctx.globalCompositeOperation="destination-over",this.ctx.lineJoin="round",this.ctx.lineWidth=this.size,this.ctx.fillStyle="rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+","+this.color[3]+")",this.ctx.strokeStyle="rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+","+this.color[3]+")",this.ctx.moveTo(a,b),this.ctx.lineTo(c,d),this.ctx.closePath(),this.ctx.stroke()}}),l=h.extend({init:function(){this._super()},strokeStart:function(a,b,c){this.ctx=a.ctx},stroke:function(a,b,c,d,e){this._super(a,b,c,d,e),this.ctx.globalCompositeOperation="source-over";var f=0,g=0;for(i=this._x1;i<=this._x2;i+=this.size/4){g=0;for(j=this._y1;j<=this._y2;j+=this.size/4){if(f==g){var h=this.ctx.createRadialGradient(i,j,this.size/32,i,j,this.size/2);h.addColorStop(0,"rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+",1)"),h.addColorStop(1,"rgba("+this.color[0]+","+this.color[1]+","+this.color[2]+",0)"),this.ctx.fillStyle=h,this.ctx.beginPath(),this.ctx.fillRect(i-.5*this.size,j-.5*this.size,this.size,this.size),this.ctx.fill(),this.ctx.closePath()}g+=1}f+=1}}});m.prototype.bind_canvas_handlers=function(){this.opts.container.mousedown(function(a){b.handle_cevent(a.offsetX,a.offsetY,!1,a)}),this.opts.container.mouseup(function(a){b.handle_cevent(a.offsetX,a.offsetY,!1,a)}),this.opts.container.mousemove(function(a){b.handle_cevent(a.offsetX,a.offsetY,!0,a)}),this.opts.container.mouseleave(function(a){b.handle_cevent(a.offsetX,a.offsetY,!1,a)}),this.opts.container.mouseenter(function(a){b.handle_cevent(a.offsetX,a.offsetY,!1,a)})},m.prototype.unbind_canvas_handlers=function(){this.opts.container.unbind()},m.prototype.arrange_layers=function(){var b=10;a.each(this.layers,function(a,c){c.canvas.jobject.css("z-index",b),b-=1})},m.prototype.create_layer=function(b){var c=!1;a.each(this.layers,function(a,d){typeof b!="undefined"&&(d.name==b.name&&(c=!0))});if(c)return!1;this.layers.push({id:b.id,name:b.name,canvas:new g(b.name),log:b.log.slice(0)}),this.arrange_layers();return this.layers[this.layers.length-1]},m.prototype.get_layer=function(b){var c=!1;a.each(this.layers,function(a,d){d.id==b&&(c=d)});return c},m.prototype.show_slide=function(b){a.each(this.layers,function(c,d){d==b?a(d.canvas.element).show():a(d.canvas.element).hide()})},m.prototype.delete_from_log=function(b){a.each(this.layers,function(a,b){})},m.prototype.delete_layer=function(c){a.each(this.layers,function(d,e){typeof c!="undefined"&&(e!==undefined&&(c.name==e.name&&(a("#"+e.name+"-canvas").remove(),b.layers.splice(d,1))))}),this.arrange_layers(),this.layer=this.layers[this.layers.length-1].id},m.prototype.change_layer_order=function(c,d){d>=0&&d<this.layers.length&&(a.each(this.layers,function(a,e){if(e!==undefined)if(e.id==c){var f=b.layers.splice(a,1),g=b.layers.slice(0,d),h=b.layers.slice(d,b.layers.length);b.layers=g.concat(f).concat(h)}}),this.arrange_layers())},m.prototype.resize=function(){function c(a,d){var e=a.shift();e!=undefined&&(e[0]=="fill"?(b.layer=d,b.handle_action(e[0],e[1],d).done(function(){if(a.length>0)c(a,d);else return})):(b.layer=d,b.handle_action(e[0],e[1],d),c(a,d)))}a.each(this.layers,function(a,d){d.canvas.ctx.canvas.width=b.opts.container.width(),d.canvas.ctx.canvas.height=b.opts.container.height(),c(d.log.slice(0),d)})},m.prototype.draw=function(a,c,d,e){switch(a){case"brush":prev_params=c[0],c=c[1];var f=this.brushes[c[5]];f.color=c[2],f.size=c[4],c[3]?f.stroke(prev_params[0],prev_params[1],c[0],c[1],c[6],c[3]):f.strokeStart(e.canvas,c[0],c[1]);break;case"shape":e.canvas.ctx.globalCompositeOperation="source-over",e.canvas.ctx.lineJoin="round",e.canvas.ctx.fillStyle="rgba("+c[2][0][0]+","+c[2][0][1]+","+c[2][0][2]+","+c[2][0][3]+")",e.canvas.ctx.beginPath();if(c[4]=="rect")e.canvas.ctx.rect(c[0][0],c[1][0],c[0][1],c[1][1]);else if(c[4]=="circle"){var g=Math.abs(c[0][1]);if(g>0){var h=this.get_layer(this.layer);e.canvas.ctx.arc(c[0][0],c[1][0],g,0,Math.PI*2,!0)}}c[3]>0&&(e.canvas.ctx.lineWidth=c[3],e.canvas.ctx.strokeStyle="rgba("+c[2][1][0]+","+c[2][1][1]+","+c[2][1][2]+","+c[2][1][3]+")",e.canvas.ctx.stroke()),e.canvas.ctx.closePath(),e.canvas.ctx.fill();break;case"fill":var i=b.opts.container.width(),j=b.opts.container.height();this.worker.postMessage({pixeldata:e.canvas.ctx.getImageData(0,0,i,j),startXY:c[0],fillColor:c[1],startColor:c[2],width:i,height:j}),this.worker.addEventListener("message",function(a){e.canvas.ctx.putImageData(a.data.pixeldata,0,0);if(d!=undefined)return d.resolve()},!1);break;case"text":e.canvas.ctx.font=c[4],e.canvas.ctx.fillStyle="rgba("+c[2][0][0]+","+c[2][0][1]+","+c[2][0][2]+","+c[2][0][3]+")",c[3]>0&&(e.canvas.ctx.lineWidth=c[3],e.canvas.ctx.strokeStyle="rgba("+c[2][1][0]+","+c[2][1][1]+","+c[2][1][2]+","+c[2][1][3]+")",e.canvas.ctx.strokeText(c[5],c[0],c[1])),e.canvas.ctx.fillText(c[5],c[0],c[1])}},m.prototype.handle_action=function(b,c,d){var e=a.Deferred();if(d!=undefined)switch(b){case"brush":c[3]||(this.remote_prev_action=c),d.log.push(["brush",c]),this.draw("brush",[this.remote_prev_action,c],e,d),this.remote_prev_action=c;break;case"shape":d.log.push(["shape",c]),this.draw("shape",c,e,d);return e.resolve();case"fill":d.log.push(["fill",c]),this.draw("fill",c,e,d);break;case"text":d.log.push(["text",c]),this.draw("text",c,e,d);return e.resolve()}return e},m.prototype.handle_cevent=function(b,f,g,h){var i=[];if(h.type!="mousemove"||this.tool_active)if(h.type=="mouseleave")this.opts.ws_handler.remote("/data/pad/"+this.opts.pad_id+"/mouse/leave/",{},function(a){});else switch(this.tool){case"brush":switch(h.type){case"mousedown":c=(new Date).getTime(),i=[b,f,this.fg_color,g,this.brush_size,this.brush,0],this.prev_action=i,this.layer.log.push(["brush",i]),this.tool_active=!0,this.draw("brush",[this.prev_action,i],null,this.layer),this.opts.ws_handler.remote("/data/pad/"+this.opts.pad_id+"/layers/"+this.layer.id+"/draw/brush/",{params:i},function(a){});break;case"mousemove":this.tool_active&&(d=(new Date).getTime()-c,c=(new Date).getTime(),i=[b,f,this.fg_color,g,this.brush_size,this.brush,d],this.layer.log.push(["brush",i]),this.draw("brush",[this.prev_action,i],null,this.layer),this.opts.ws_handler.remote("/data/pad/"+this.opts.pad_id+"/layers/"+this.layer.id+"/draw/brush/",{params:i},function(a){}),this.prev_action=i);break;case"mouseup":this.tool_active=!1;break;case"mouseleave":break;case"mouseenter":}break;case"shape":switch(h.type){case"mousedown":this.snapshot=this.layer.canvas.ctx.getImageData(0,0,this.opts.container.width(),this.opts.container.height()),this.tmplog=[],this.tmplog=[[],[],[this.bg_color,this.fg_color],this.line_width,this.shape],this.tmplog[0].push(b),this.tmplog[1].push(f),this.tool_active=!0;break;case"mouseup":this.tool_active=!1,this.tmplog[0].push(b-this.tmplog[0][0]),this.tmplog[1].push(f-this.tmplog[1][0]),this.layer.log.push(["shape",this.tmplog]),this.opts.ws_handler.remote("/data/pad/"+this.opts.pad_id+"/layers/"+this.layer.id+"/draw/shape/",this.tmplog,function(a){});break;case"mousemove":this.tool_active==!0&&(this.layer.canvas.ctx.putImageData(this.snapshot,0,0),i=[[this.tmplog[0][0],b-this.tmplog[0][0]],[this.tmplog[1][0],f-this.tmplog[1][0]],[this.bg_color,this.fg_color],this.line_width,this.shape],this.draw("shape",i,null,this.layer))}break;case"fill":switch(h.type){case"mouseup":var j=this.layer.canvas.ctx.getImageData(b,f,1,1).data;i=[[b,f],this.bg_color,j],this.layer.log.push(["fill",i]),this.draw("fill",i,null,this.layer),this.opts.ws_handler.remote("/data/pad/"+this.opts.pad_id+"/layers/"+this.layer.id+"/draw/fill/",{params:i},function(a){})}break;case"text":switch(h.type){case"mousedown":var k=a("#text-input").val();k!=""&&(a("#text-input").val(""),i=[b,f,[this.bg_color,this.fg_color],this.text_line_width,this.font_size+"pt Calibri",k],this.layer.log.push(["text",i]),this.draw("text",i,null,this.layer),this.opts.ws_handler.remote("/data/pad/"+this.opts.pad_id+"/layers/"+this.layer.id+"/draw/text/",{params:i},function(a){}));break;case"mouseup":break;case"mousemove":break;case"mousedown":}}else e%1==0&&this.opts.ws_handler.remote("/data/pad/"+this.opts.pad_id+"/mouse/bc/",{params:[b,f]},function(a){}),e+=1},m.prototype.clear_canvas=function(){a.each(this.layers,function(a,c){c.log=[],c.canvas.ctx.clearRect(0,0,b.opts.container.width(),b.opts.container.height())})},a.extend({cpaint_settings:{container:"",canvas:"",subscribe_action:"",cb_insert:"",cb_delete:"",cb_undo:""},collapaint:function(b,c){f=a.extend(a.cpaint_settings,c),f.ws_handler=b,collapaint=new m(f);return collapaint}})}(jQuery),define("lib/jquery/jquery.cpaint",function(){}),define("modules/pad",["order!lib/jquery/jquery.color","order!lib/jquery/jquery.cpaint"],function(){function bind_events(){$("#slide-overview-slides").delegate(".slide-overview-slide","click",function(a){$("#slide-overview-slides > .slide-overview-slide").removeClass("slide-overview-slide-selected"),$(this).addClass("slide-overview-slide-selected"),$("#slide-title").text($(this).data("name")),cpaint.layer=cpaint.get_layer(parseInt($(this).attr("id").substring(3))),cpaint.show_slide(cpaint.layer)}),$(document).bind("infinote_update",function(a){}),$("#brush-tools-size").slider({min:1,max:100,value:8,create:function(a,b){cpaint.brush_size=8,$("#brush-tools-size-indicator").html(cpaint.brush_size+"px")},change:function(a,b){cpaint.brush_size=b.value,$("#brush-tools-size-indicator").html(cpaint.brush_size+"px")}}),$("#shape-tools-line-width").slider({min:0,max:50,value:1,create:function(a,b){cpaint.line_width=1,$("#shape-tools-line-width-indicator").html(cpaint.line_width+"px")},change:function(a,b){cpaint.line_width=b.value,$("#shape-tools-line-width-indicator").html(cpaint.line_width+"px")}}),$("#text-tools-line-width").slider({min:0,max:10,value:0,create:function(a,b){cpaint.text_line_width=0,$("#text-tools-line-width-indicator").html(cpaint.text_line_width+"px")},change:function(a,b){cpaint.text_line_width=b.value,$("#text-tools-line-width-indicator").html(cpaint.text_line_width+"px")}}),$("#text-tools-font-size").slider({min:8,max:50,value:8,create:function(a,b){cpaint.font_size=8,$("#text-tools-font-size-indicator").html(cpaint.font_size+"px")},change:function(a,b){cpaint.font_size=b.value,$("#text-tools-font-size-indicator").html(cpaint.font_size+"px")}}),$("#brush-selector").change(function(){cpaint.brush=$("#brush-selector").val()}),$("#shape-selector").change(function(){cpaint.shape=$("#shape-selector").val()}),$("#pp-picker-hue").mousedown(function(a){spectrum_click=!0,_bg_color=cpaint.bg_color,_fg_color=cpaint.fg_color}),$("#pp-picker-hue").mouseout(function(a){spectrum_click=!1,application.functions.pad.set_selected_slot_color([_bg_color,_fg_color],!0)}),$("#pp-picker-hue").mouseup(function(c){spectrum_click=!1,application.functions.pad.set_selected_slot_color([r,g,b,a],!0)}),$("#pp-picker-hue").mousemove(function(event){if(spectrum_click!=!1){h=event.layerX/event.currentTarget.clientWidth;var ratio;switch(!0){case h<1/6:ratio=h/(1/6);with(Math)r=255,g=ceil(ratio*255),b=0;break;case h<2/6:ratio=(h-1/6)/(1/6);with(Math)r=ceil(abs(ratio-1)*255),g=255,b=0;break;case h<.5:ratio=(h-2/6)/(1/6);with(Math)r=0,g=255,b=ceil(ratio*255);break;case h<4/6:ratio=(h-.5)/(1/6);with(Math)r=0,g=ceil(abs(ratio-1)*255),b=255;break;case h<5/6:ratio=(h-4/6)/(1/6);with(Math)r=ceil(ratio*255),g=0,b=255;break;case h<1:ratio=(h-5/6)/(1/6);with(Math)r=255,g=0,b=ceil(abs(ratio-1)*255)}var _c=$.Color([h,s,v],"HSV").toRGB();$("#pp-picker-hsv-color").css("background-color","rgb("+r+","+g+","+b+")"),r=_c[0],g=_c[1],b=_c[2],$("#pp-picker-alpha").css("background-image","-webkit-gradient(linear,left center,right center,color-stop(0, rgba("+r+","+g+","+b+",1)),color-stop(1, rgba("+r+","+g+","+b+",0)))"),$("#pp-picker-alpha").css("background-image","-moz-linear-gradient(left, rgba("+r+","+g+","+b+",1),rgba("+r+","+g+","+b+",0))"),application.functions.pad.set_selected_slot_color([r,g,b,a],!1)}}),$("#pp-picker-alpha").mousedown(function(a){opacity_click=!0,_bg_color=cpaint.bg_color,_fg_color=cpaint.fg_color}),$("#pp-picker-alpha").mouseout(function(a){opacity_click=!1,application.functions.pad.set_selected_slot_color([_bg_color,_fg_color],!0)}),$("#pp-picker-alpha").mouseup(function(c){opacity_click=!1,application.functions.pad.set_selected_slot_color([r,g,b,a],!0)}),$("#pp-picker-alpha").mousemove(function(c){opacity_click!=!1&&(a=1-c.layerX/c.currentTarget.clientWidth,application.functions.pad.set_selected_slot_color([r,g,b,a],!1))}),$("#pp-picker-hsv").mousedown(function(a){wb_click=!0,_bg_color=cpaint.bg_color,_fg_color=cpaint.fg_color}),$("#pp-picker-hsv").mouseout(function(a){wb_click=!1,application.functions.pad.set_selected_slot_color([_bg_color,_fg_color],!0)}),$("#pp-picker-hsv").mouseup(function(c){wb_click=!1,application.functions.pad.set_selected_slot_color([r,g,b,a],!0)}),$("#pp-picker-hsv").mousemove(function(c){if(wb_click!=!1){s=c.layerX/c.currentTarget.clientWidth,v=1-c.layerY/c.currentTarget.clientHeight;var d=$.Color([h,s,v],"HSV").toRGB();r=d[0],g=d[1],b=d[2],application.functions.pad.set_selected_slot_color([r,g,b,a],!1),$("#pp-picker-alpha").css("background-image","-webkit-gradient(linear,left center,right center,color-stop(0, rgba("+r+","+g+","+b+",1)),color-stop(1, rgba("+r+","+g+","+b+",0)))")}}),$("#pp-color-slots > div").click(function(a){if($(this).hasClass("pp-color-slot-selected"))$(this).removeClass("pp-color-slot-selected");else{$(this).addClass("pp-color-slot-selected");var b=$(this).siblings();b.hasClass("pp-color-slot-selected")&&b.removeClass("pp-color-slot-selected")}}),$(window).resize(function(a){window.clearTimeout(resizeTimeoutId),resizeTimeoutId=window.setTimeout(function(){cpaint.resize()},1e3)})}function bind_ws(){application.ws.method("^/data/pad/"+pad_id+"/mouse/receive/$",function(a){application.functions.pad.draw_remote_pointer(a.params[0],a.params[1],a.params[2])}),application.ws.method("^/data/pad/"+pad_id+"/mouse/leave/$",function(a){application.functions.pad.kill_remote_pointers(a.params[0])}),application.ws.method("^/data/pad/"+pad_id+"/layers/(?<layer_id>[^/]+)/draw/brush/$",function(a){application.functions.pad.draw_remote_pointer(a.params[0],a.params[1],a.params[7]),cpaint.handle_action("brush",a.params,cpaint.get_layer(parseInt(a.layer_id)))}),application.ws.method("^/data/pad/"+pad_id+"/layers/(?<layer_id>[^/]+)/draw/shape/$",function(a){application.functions.pad.draw_remote_pointer(a.params[0],a.params[1],a.params[5]),cpaint.handle_action("shape",a.params,cpaint.get_layer(parseInt(a.layer_id)))}),application.ws.method("^/data/pad/"+pad_id+"/layers/(?<layer_id>[^/]+)/draw/text/$",function(a){application.functions.pad.draw_remote_pointer(a.params[0],a.params[1],a.params[6]),cpaint.handle_action("text",a.params,cpaint.get_layer(parseInt(a.layer_id)))}),application.ws.method("^/data/pad/"+pad_id+"/layers/(?<layer_id>[^/]+)/draw/fill/$",function(a){cpaint.handle_action("fill",a.params,cpaint.get_layer(parseInt(a.layer_id)))}),application.ws.method("^/data/pad/"+pad_id+"/clear/$",function(a){cpaint.clear_canvas()}),application.ws.method("^/data/pad/"+pad_id+"/save/$",function(a){}),application.ws.method("^/data/pad/"+pad_id+"/layers/(?<layer_name>[^/]+)/create/$",function(a){cpaint.layer=cpaint.create_layer(a.data.layer),application.functions.pad.show_layers(cpaint.layer.id)}),application.ws.method("^/data/pad/"+pad_id+"/layers/(?<layer_name>[^/]+)/delete/$",function(a){cpaint.delete_layer(a.data.layer),cpaint.layer=cpaint.layers[cpaint.layers.length-1],application.functions.pad.show_layers(cpaint.layers[cpaint.layers.length-1].id)}),application.ws.method("^/data/pad/"+pad_id+"/layers/(?<layer_name>[^/]+)/order/$",function(a){var b=a.data.layers;$.each(b,function(a,c){$.each(cpaint.layers,function(d,e){c.id==e.id&&(b[a].canvas=e.canvas)})}),cpaint.layers=b,cpaint.layer=cpaint.get_layer(a.data.id),cpaint.arrange_layers(),application.functions.pad.show_layers(a.data.id)}),application.ws.method("^/data/plasmoid/(?<plasmoid_id>[^/]+)/online/update/$",function(a){plasmoid_editor.update_online(a.online)})}function bind_functions(){application.functions.pad={route:function(a,b){urls==undefined&&(urls=[[XRegExp("^/pad/(?<pad_id>[^/]+)/$"),application.functions.pad.view_pad]]),application.route_uri_to_mod_function(a,urls,b)},view_pad:function(a){application.ws.remote("/pad/"+a.pad_id+"/",{},function(b){function c(a,b){var d=a.shift();d!=undefined&&(d[0]=="fill"?(cpaint.layer=b,cpaint.handle_action(d[0],d[1],b).done(function(){if(a.length>0)c(a,b);else return})):(cpaint.layer=b,cpaint.handle_action(d[0],d[1],b),c(a,b)))}application.functions.ui.transition(b.data.dom.main,$(".main")),application.functions.ui.add_widgets([b.data.dom.left]),cpaint=$.collapaint(application.ws,{pad_id:a.pad_id,container:$(".canvas-container"),width:$(".canvas-container").width(),height:500}),cpaint.fg_color=[0,174,239,1],cpaint.bg_color=[0,0,0,1],$.each(b.data.layers,function(a,b){var d=cpaint.create_layer(b);c(b.log,d)}),cpaint.arrange_layers(),cpaint.layer=cpaint.layers[0],application.functions.pad.show_layers(cpaint.layer.id),switch_tool("brush"),bind_events(),$('div[id*="psycopad-widget"]').hide().fadeIn("fast",function(){})})},clear_pad:function(){cpaint.clear_canvas(),application.ws.remote("/data/pad/"+pad_id+"/clear/",{params:[]},function(a){})},save_pad:function(){application.ws.remote("/data/pad/"+pad_id+"/save/",{},function(a){})},select_brush_tool:function(){switch_tool("brush")},select_shape_tool:function(){switch_tool("shape")},select_fill_tool:function(){switch_tool("fill")},select_text_tool:function(){switch_tool("text")},create_layer:function(){var a="Unnamed_"+Math.ceil(Math.random()*100);application.ws.remote("/data/pad/"+pad_id+"/layers/"+a+"/create/",{},function(a){})},delete_layer:function(){var a=$(".slide-overview-slide-selected > span").text();cpaint.layers.length>1?application.ws.remote("/data/pad/"+pad_id+"/layers/"+a+"/delete/",{},function(a){}):console.log("Can't remove last layer")},move_layer_up:function(){var a=$(".slide-overview-slide-selected"),b=a.attr("id").substring(3),c=a.prevAll().length;application.ws.remote("/data/pad/"+pad_id+"/layers/"+b+"/order/",{to_position:c-1},function(a){})},move_layer_down:function(){var a=$(".slide-overview-slide-selected"),b=a.attr("id").substring(3),c=a.prevAll().length;application.ws.remote("/data/pad/"+pad_id+"/layers/"+b+"/order/",{to_position:c+1},function(a){})},open_plasmoid_layer:function(){var a=$(".slide-overview-slide-selected"),b=a.attr("id").substring(3);if($("#plasmoid-editor").is(":visible"))cpaint.bind_canvas_handlers(),$("#plasmoid-editor").hide("slide",{direction:"up"},300,function(){plasmoid_editor.disconnect()});else{cpaint.unbind_canvas_handlers(),$("#plasmoid-title").text(a.text()),$("#plasmoid-editor").show("slide",{direction:"up",easing:"easeOutBounce"},800,function(){});var c=pad_id+"_"+b;plasmoid_editor=$.jinfinote(application.ws,{ws_connect:"/data/plasmoid/"+c+"/connect/",ws_disconnect:"/data/plasmoid/"+c+"/disconnect/",ws_insert:"/data/plasmoid/"+c+"/insert/",ws_delete:"/data/plasmoid/"+c+"/delete/",ws_undo:"/data/plasmoid/"+c+"/undo/",ws_caret:"/data/plasmoid/"+c+"/caret/",cb_insert:"^/data/plasmoid/"+c+"/insert/$",cb_delete:"^/data/plasmoid/"+c+"/delete/$",cb_undo:"^/data/plasmoid/"+c+"/undo/$",cb_caret:"^/data/plasmoid/"+c+"/caret/$",editor:"code",init:function(a){return $("#plasmoid-editor")}})}},play_plasmoid_layer:function(){var a=$(".slide-overview-slide-selected"),b=a.attr("id").substring(3),c=a.text();application.ws.remote("/data/plasmoid/"+pad_id+"_"+b+"/play/",{},function(a){var b=Processing.compile(a.data.script).sourceCode;console.log(b),plasmoid_container=new Processing($("#"+c+"-canvas").get(0),a.data.script)})},pause_plasmoid_layer:function(){},set_selected_slot_color:function(a,b){var c=$(".pp-color-slot-selected > div").attr("id");typeof c!="undefined"&&(b?a.length==4?c.indexOf("fgcolor")!=-1?(cpaint.fg_color=a,_fg_color=a,$(".pp-color-slot-selected > div").css("background-color","rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")")):c.indexOf("bgcolor")!=-1&&(cpaint.bg_color=a,_bg_color=a,$(".pp-color-slot-selected > div").css("background-color","rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")")):a.length==2&&(c.indexOf("fgcolor")!=-1?a=a[1]:c.indexOf("bgcolor")!=-1&&(a=a[0]),a!=undefined&&$(".pp-color-slot-selected > div").css("background-color","rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")")):$(".pp-color-slot-selected > div").css("background-color","rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"))},show_layers:function(a){$("#slide-overview-slides").empty(),$.each(cpaint.layers,function(b,c){$("#slide-overview-slides").append('<div data-name="'+c.name+'" id="id_'+c.id+'" class="slide-overview-slide"><span>'+c.name+"</span></div>"),a!=null&&(a==c.id&&($("#id_"+a).addClass("slide-overview-slide-selected"),$("#slide-title").text(c.name),cpaint.show_slide(c)))}),a==null&&$("#slide-overview-slides div:last-child").addClass("slide-overview-slide-selected")},draw_remote_pointer:function(a,b,c){c=c.replace(" ","_");var d=$("#pointer-"+c);!d.length>0&&$("body").append('<div id="pointer-'+c+'" class="remote-brush"><span>'+c+"</span></div>"),pos_store[c]===undefined&&(pos_store[c]=[]);var e=$(".canvas-container").offset(),f=$(".canvas-container").width(),g=$(".canvas-container").height(),h=$(".remote-brush").width(),i=$(".remote-brush").height();pos_store[c].push([a,b]),$(d).css("left",e.left+a-h/2+"px"),$(d).css("top",e.top+b-i/2+"px"),e.left+a>e.left+f||e.top+b>e.top+g?$(d).css("display","none"):e.left+a<e.left||e.top+b<e.top?$(d).css("display","none"):$(d).css("display","block")},kill_remote_pointers:function(a){a!==undefined?(a=a.replace(" ","_"),$("#pointer-"+a).remove()):$(".remote-brush").remove()}}}function switch_tool(a){cpaint.tool=a;switch(a){case"brush":$("#shape-tools").hide(),$("#text-tools").hide(),$("#brush-tools").show(),$("canvas").removeClass("canvas-shape"),$("canvas").removeClass("canvas-text"),$("canvas").addClass("canvas-brush");break;case"shape":$("#brush-tools").hide(),$("#text-tools").hide(),$("#shape-tools").show(),$("canvas").removeClass("canvas-brush"),$("canvas").removeClass("canvas-text"),$("canvas").addClass("canvas-shape");break;case"fill":$("#brush-tools").hide(),$("#shape-tools").hide(),$("#text-tools").hide(),$("canvas").removeClass("canvas-brush"),$("canvas").removeClass("canvas-shape"),$("canvas").removeClass("canvas-text"),$("canvas").addClass("canvas-fill");break;case"text":$("#brush-tools").hide(),$("#shape-tools").hide(),$("#text-tools").show(),$("canvas").removeClass("canvas-brush"),$("canvas").removeClass("canvas-shape"),$("canvas").addClass("canvas-text")}}var plasmoid_editor,plasmoid_editor_lc,plasmoid_container,cpaint,_bg_color,_fg_color,r=255,g=0,b=0,a=1,h=0,s=1,v=1,spectrum_click=!1,opacity_click=!1,wb_click=!1,pos_store={},pad_id,resizeTimeoutId,urls,slide_context;return{init:function(a,b){slide_context=$.context({anchor:".main",delegate:"#slide-context",uri:"/pad/context/",id:"ctx-slide"}),application.cache.load.context.slide=!0,bind_functions(),pad_id="development",bind_ws(),application.functions.pad.route(a,b);return"pad"},load:function(a,b){typeof application.cache.load.context.slide=="undefined"&&(application.cache.load.context.slide=!0,slide_context.reload()),$('div[class*="slide-widget"]').remove(),application.functions.pad.route(a,b)},clean_up:function(){$('div[class*="slide-widget"]').remove(),application.functions.pad.kill_remote_pointers()}}})