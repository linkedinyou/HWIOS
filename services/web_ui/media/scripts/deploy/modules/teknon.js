function init(){if(navigator.appName=="Microsoft Internet Explorer"){obj=document.getElementsByTagName("TEXTAREA");var a,b=0;for(var b=0;b<obj.length;b++)a=obj[b],caretPositionAmp[b]=a.value.length,a.onmouseup=function(){a=document.activeElement;for(var b=0;b<obj.length;b++)if(obj[b]==a)break;a.focus();var c=document.selection.createRange(),d=a.createTextRange(),e=d.duplicate();d.moveToBookmark(c.getBookmark()),e.setEndPoint("EndToStart",d),caretPositionAmp[b]=e.text.length},a.onkeyup=function(){a=document.activeElement;for(var b=0;b<obj.length;b++)if(obj[b]==a)break;a.focus();var c=document.selection.createRange(),d=a.createTextRange(),e=d.duplicate();d.moveToBookmark(c.getBookmark()),e.setEndPoint("EndToStart",d),caretPositionAmp[b]=e.text.length}}}var caretPositionAmp=[];window.onload=init,jQuery.fn.extend({getSelection:function(){var a=this.jquery?this[0]:this,b,c,d,e=0;a.onmousedown=function(){document.selection&&typeof a.selectionStart!="number"?document.selection.empty():window.getSelection().removeAllRanges()};if(document.selection){var f=document.selection.createRange(),g=0,h=0,i=0,j,k,l=document.getElementsByTagName("TEXTAREA"),m=0;for(m;m<l.length;m++)if(l[m]==a)break;a.value.match(/\n/g)!=null&&(e=a.value.match(/\n/g).length);if(f.text){d=f.text;if(typeof a.selectionStart=="number"){b=a.selectionStart,c=a.selectionEnd;if(b==c)return{start:b,end:c,text:f.text,length:c-b}}else{j=a.createTextRange(),k=j.duplicate(),firstRe=j.text,j.moveToBookmark(f.getBookmark()),secondRe=j.text,k.setEndPoint("EndToStart",j);if(firstRe==secondRe&&firstRe!=f.text||k.text.length>firstRe.length)return{start:caretPositionAmp[m],end:caretPositionAmp[m],text:"",length:0};b=k.text.length,c=k.text.length+f.text.length}if(e>0)for(var n=0;n<=e;n++){var o=a.value.indexOf("\n",h);if(o!=-1&&o<b)h=o+1,g++,i=g;else if(o==-1||o<b||o>c)n=e;else{if(o==b+1){g--,i--,h=o+1;continue}h=o+1,i++}}f.text.indexOf("\n",0)==1&&(i=i+2),b=b-g,c=c-i;return{start:b,end:c,text:f.text,length:c-b}}a.focus(),typeof a.selectionStart=="number"?b=a.selectionStart:(f=document.selection.createRange(),j=a.createTextRange(),k=j.duplicate(),j.moveToBookmark(f.getBookmark()),k.setEndPoint("EndToStart",j),b=k.text.length);if(e>0)for(var n=0;n<=e;n++){var o=a.value.indexOf("\n",h);o!=-1&&o<b?(h=o+1,g++):n=e}b=b-g,b==0&&typeof a.selectionStart!="number"&&(b=caretPositionAmp[m],c=caretPositionAmp[m]);return{start:b,end:b,text:f.text,length:0}}if(typeof a.selectionStart=="number"){b=a.selectionStart,c=a.selectionEnd,d=a.value.substring(a.selectionStart,a.selectionEnd);return{start:b,end:c,text:d,length:c-b}}return{start:undefined,end:undefined,text:undefined,length:undefined}},replaceSelection:function(a){var b=this.jquery?this[0]:this,c,d,e=0,f,g,h=0,i=0,j=b.scrollTop==undefined?0:b.scrollTop,k=document.getElementsByTagName("TEXTAREA"),l=0;for(l;l<k.length;l++)if(k[l]==b)break;if(document.selection&&typeof b.selectionStart!="number"){var m=document.selection.createRange();if(typeof b.selectionStart!="number"){var n,o;g=b.createTextRange(),f=g.duplicate(),n=g.text,g.moveToBookmark(m.getBookmark()),o=g.text;try{f.setEndPoint("EndToStart",g)}catch(p){return this}if(n==o&&n!=m.text||f.text.length>n.length)return this}if(m.text){part=m.text,b.value.match(/\n/g)!=null&&(h=b.value.match(/\n/g).length),c=f.text.length;if(h>0)for(var q=0;q<=h;q++){var r=b.value.indexOf("\n",e);r!=-1&&r<c?(e=r+1,i++):q=h}m.text=a,caretPositionAmp[l]=f.text.length+a.length,g.move("character",caretPositionAmp[l]),document.selection.empty(),b.blur()}return this}if(typeof b.selectionStart=="number"&&b.selectionStart!=b.selectionEnd){c=b.selectionStart,d=b.selectionEnd,b.value=b.value.substr(0,c)+a+b.value.substr(d),e=c+a.length,b.setSelectionRange(e,e),b.scrollTop=j;return this}return this},setSelection:function(a,b){a=parseInt(a),b=parseInt(b);var c=this.jquery?this[0]:this;c.focus(),typeof c.selectionStart!="number"&&(re=c.createTextRange(),re.text.length<b&&(b=re.text.length+1));if(b<a)return this;if(document.selection){var d=0,e=0,f=0,g=0;if(typeof c.selectionStart!="number"){re.collapse(!0),re.moveEnd("character",b),re.moveStart("character",a),re.select();return this}if(typeof c.selectionStart=="number"){c.value.match(/\n/g)!=null&&(d=c.value.match(/\n/g).length);if(d>0)for(var h=0;h<=d;h++){var i=c.value.indexOf("\n",f);if(i!=-1&&i<a)f=i+1,e++,g=e;else if(i==-1||i<a||i>b)h=d;else{if(i==a+1){e--,g--,f=i+1;continue}f=i+1,g++}}a=a+e,b=b+g,c.selectionStart=a,c.selectionEnd=b,c.focus();return this}c.focus();return this}if(c.selectionStart||c.selectionStart==0){c.focus(),window.getSelection().removeAllRanges(),c.selectionStart=a,c.selectionEnd=b,c.focus();return this}},insertAtCaretPos:function(a){var b=this.jquery?this[0]:this,c,d,e,f,g,h,i,j=0,k=0,l=b.scrollTop==undefined?0:b.scrollTop,m=document.getElementsByTagName("TEXTAREA"),n=0;for(n;n<m.length;n++)if(m[n]==b)break;b.focus();if(document.selection&&typeof b.selectionStart!="number"){b.value.match(/\n/g)!=null&&(k=b.value.match(/\n/g).length),i=parseInt(caretPositionAmp[n]);if(k>0)for(var o=0;o<=k;o++){var p=b.value.indexOf("\n",e);p!=-1&&p<=i&&(e=p+1,i=i-1,j++)}}caretPositionAmp[n]=parseInt(caretPositionAmp[n]),b.onkeyup=function(){document.selection&&typeof b.selectionStart!="number"&&(b.focus(),f=document.selection.createRange(),g=b.createTextRange(),h=g.duplicate(),g.moveToBookmark(f.getBookmark()),h.setEndPoint("EndToStart",g),caretPositionAmp[n]=h.text.length)},b.onmouseup=function(){document.selection&&typeof b.selectionStart!="number"&&(b.focus(),f=document.selection.createRange(),g=b.createTextRange(),h=g.duplicate(),g.moveToBookmark(f.getBookmark()),h.setEndPoint("EndToStart",g),caretPositionAmp[n]=h.text.length)};if(document.selection&&typeof b.selectionStart!="number"){f=document.selection.createRange();if(f.text.length!=0)return this;g=b.createTextRange(),textLength=g.text.length,h=g.duplicate(),g.moveToBookmark(f.getBookmark()),h.setEndPoint("EndToStart",g),c=h.text.length,caretPositionAmp[n]>0&&c==0?(j=caretPositionAmp[n]-j,g.move("character",j),g.select(),f=document.selection.createRange(),caretPositionAmp[n]+=a.length):caretPositionAmp[n]<0&&textLength==0?(f=document.selection.createRange(),caretPositionAmp[n]=a.length+textLength):caretPositionAmp[n]<0&&c==0?(g.move("character",textLength),g.select(),f=document.selection.createRange(),caretPositionAmp[n]=a.length+textLength):caretPositionAmp[n]<0&&c>0?(g.move("character",0),document.selection.empty(),g.select(),f=document.selection.createRange(),caretPositionAmp[n]=c+a.length):caretPositionAmp[n]<0||caretPositionAmp[n]!=textLength?caretPositionAmp[n]<0||c==0||caretPositionAmp[n]<c?caretPositionAmp[n]>=0&&c!=0&&caretPositionAmp[n]<c?(g.move("character",0),document.selection.empty(),g.select(),f=document.selection.createRange(),caretPositionAmp[n]=caretPositionAmp[n]+a.length):(document.selection.empty(),g.select(),f=document.selection.createRange(),caretPositionAmp[n]=caretPositionAmp[n]+a.length):(j=caretPositionAmp[n]-c,g.move("character",j),document.selection.empty(),g.select(),f=document.selection.createRange(),caretPositionAmp[n]=caretPositionAmp[n]+a.length):(textLength!=0?(g.move("character",textLength),g.select()):g.move("character",0),f=document.selection.createRange(),caretPositionAmp[n]=a.length+textLength),f.text=a,b.focus();return this}if(typeof b.selectionStart=="number"&&b.selectionStart==b.selectionEnd){e=b.selectionStart+a.length,c=b.selectionStart,d=b.selectionEnd,b.value=b.value.substr(0,c)+a+b.value.substr(d),b.setSelectionRange(e,e),b.scrollTop=l;return this}return this},setCaretPos:function(a){var b=this.jquery?this[0]:this,c,d,e,f=0,g=0,h,i=document.getElementsByTagName("TEXTAREA"),j=0;for(j;j<i.length;j++)if(i[j]==b)break;b.focus();if(parseInt(a)==0)return this;if(parseInt(a)>0){a=parseInt(a)-1;if(document.selection&&typeof b.selectionStart=="number"&&b.selectionStart==b.selectionEnd){b.value.match(/\n/g)!=null&&(f=b.value.match(/\n/g).length);if(f>0)for(var k=0;k<=f;k++)h=b.value.indexOf("\n",e),h!=-1&&h<=a&&(e=h+1,a=parseInt(a)+1)}}else{if(parseInt(a)>=0)return this;a=parseInt(a)+1;if(document.selection&&typeof b.selectionStart!="number"){a=b.value.length+parseInt(a),b.value.match(/\n/g)!=null&&(f=b.value.match(/\n/g).length);if(f>0){for(var k=0;k<=f;k++)h=b.value.indexOf("\n",e),h!=-1&&h<=a&&(e=h+1,a=parseInt(a)-1,g+=1);a=a+g-f}}else if(document.selection&&typeof b.selectionStart=="number"){a=b.value.length+parseInt(a),b.value.match(/\n/g)!=null&&(f=b.value.match(/\n/g).length);if(f>0){a=parseInt(a)-f;for(var k=0;k<=f;k++)h=b.value.indexOf("\n",e),h!=-1&&h<=a&&(e=h+1,a=parseInt(a)+1,g+=1)}}else a=b.value.length+parseInt(a)}if(document.selection&&typeof b.selectionStart!="number"){c=document.selection.createRange();if(c.text!=0)return this;d=b.createTextRange(),d.collapse(!0),d.moveEnd("character",a),d.moveStart("character",a),d.select(),caretPositionAmp[j]=a;return this}if(typeof b.selectionStart=="number"&&b.selectionStart==b.selectionEnd){b.setSelectionRange(a,a);return this}return this},countCharacters:function(a){var b=this.jquery?this[0]:this;if(b.value.match(/\r/g)!=null)return b.value.length-b.value.match(/\r/g).length;return b.value.length},setMaxLength:function(a,b){this.each(function(){var c=this.jquery?this[0]:this,d=c.type,e,g;parseInt(a)<0&&(a=1e8),d=="text"&&(c.maxLength=a);if(d=="textarea"||d=="text")c.onkeypress=function(d){var h=c.value.match(/\r/g);g=a,h!=null&&(g=parseInt(g)+h.length);var i=d||event,j=i.keyCode;document.selection?e=document.selection.createRange().text.length>0:e=c.selectionStart!=c.selectionEnd;if(c.value.length>=g&&(j>47||j==32||j==0||j==13)&&!i.ctrlKey&&!i.altKey&&!e){c.value=c.value.substring(0,g),typeof b=="function"&&b();return!1}},c.onkeyup=function(){var d=c.value.match(/\r/g),e=0,h=0;g=a;if(d!=null){for(var i=0;i<=d.length;i++)c.value.indexOf("\n",h)<=parseInt(a)&&(e++,h=c.value.indexOf("\n",h)+1);g=parseInt(a)+e}if(c.value.length>g){c.value=c.value.substring(0,g),typeof b=="function"&&b();return this}};else return this});return this}}),define("lib/jquery/jquery.atools",function(){}),require.def("modules/teknon",["lib/jquery/jquery.atools"],function(a){function j(){$(document).unbind("SERVICE_CHANGED_STATE")}function i(){}function h(){application.functions.teknon={route:function(a,b){d==undefined&&(d=[[XRegExp("^/teknon/$"),application.functions.teknon.view_services]]),application.route_uri_to_mod_function(a,d,b)},view_services:function(a){application.ws.remote("/teknon/",{},function(a){application.functions.ui.transition(a.data.dom.main,$(".main")),$("#teknon-tabs").tabs()})},switch_watchdog:function(a){application.ws.remote("/data/teknon/services/watchdog/switch/",{services:[a.uuid],status:a.state},function(a){})},open_console:function(a){var d=0;typeof b[a.uuid]!="undefined"?b[a.uuid].dialog("isOpen")?d=b[a.uuid].dialog("option","position")[0]:c.length>0?(c.sort(function(a,b){return a-b}),d=c.shift()):(d=0,$.each(b,function(a,b){b.dialog("isOpen")&&(d+=35)})):$.each(b,function(a,b){b.dialog("isOpen")&&(d+=33)}),typeof b[a.uuid]=="undefined"?(b[a.uuid]=$('<div class="console-container"><div id="console-box'+a.uuid+'" class="console-box"><div id="console-lines-'+a.uuid+'" class="console-lines"></div></div><input type="text" id="console-input-'+a.uuid+'" class="console-input"></input></div>').dialog({dialogClass:"console-dialog-container",autoOpen:!1,resizable:!1,title:'<span class="ui-icon ui-icon-image"></span><span>Console '+a.name+"</span>",height:446,width:802,position:[d,d],zIndex:1e4,open:function(c,d){b[a.uuid].c_hist=[],$("#console-input-"+a.uuid).removeAttr("disabled"),$(".console-box").removeClass("console-box-disabled"),b[a.uuid].c_hist_index=0,application.ws.remote("/data/teknon/services/subscribe_console/",{services:[a.uuid]},function(c){$("#console-lines-"+a.uuid).append('<div class="console-notification">Console \''+c.data.service.name+"@"+c.data.client+"' "+gettext("connected")+"...</div>"),$(".console-box").scrollTop($(".console-box > #console-lines-"+a.uuid).outerHeight()+1e7),$("#console-input-"+a.uuid).focus(),$(document).bind("SERVICE_CHANGED_STATE",function(b,c){$.each(c,function(b,c){c.uuid==a.uuid&&(c.status=="OFF"?($("#console-input-"+a.uuid).attr("disabled","disabled"),$(".console-box").addClass("console-box-disabled")):c.status=="ON"&&($("#console-input-"+a.uuid).removeAttr("disabled"),$(".console-box").removeClass("console-box-disabled")))})}),$("#console-input-"+a.uuid).keyup(function(c){switch(c.which){case 13:var d=$("#console-input-"+a.uuid).val();d!=""&&(d=="clear"?$("#console-lines-"+a.uuid).html(""):application.ws.remote("/data/teknon/services/"+a.uuid+"/send_command/",{command:d},function(a){}),b[a.uuid].c_hist.push(d)),$("#console-input-"+a.uuid).val(""),b[a.uuid].c_hist_index=0;break;case 38:b[a.uuid].c_hist_index>=b[a.uuid].c_hist.length&&(b[a.uuid].c_hist_index=0),typeof b[a.uuid].c_hist[b[a.uuid].c_hist.length-b[a.uuid].c_hist_index-1]!=="undefined"&&$("#console-input-"+a.uuid).val(b[a.uuid].c_hist[b[a.uuid].c_hist.length-1-b[a.uuid].c_hist_index]),b[a.uuid].c_hist_index+=1;var e=$("#console-input-"+a.uuid).getSelection();$("#console-input-"+a.uuid).setCaretPos(e.end+1);break;case 40:b[a.uuid].c_hist_index<=0&&(b[a.uuid].c_hist_index=b[a.uuid].c_hist.length),typeof b[a.uuid].c_hist[b[a.uuid].c_hist.length-b[a.uuid].c_hist_index]!=="undefined"&&$("#console-input-"+a.uuid).val(b[a.uuid].c_hist[b[a.uuid].c_hist.length-b[a.uuid].c_hist_index]),b[a.uuid].c_hist_index-=1}})})},close:function(d,e){c.push(b[a.uuid].dialog("option","position")[0]),application.ws.remote("/data/teknon/services/unsubscribe_console/",{services:[a.uuid]},function(b){$(document).unbind("SERVICE_CHANGED_STATE"),$("#console-lines-"+a.uuid).append('<div class="console-notification">Console \''+b.data.service.name+"@"+b.data.client+"' "+gettext("disconnected")+"...</div>")})}}),b[a.uuid].dialog("open")):b[a.uuid].dialog("isOpen")?b[a.uuid].dialog("moveToTop"):(b[a.uuid].dialog("option","position",[d,d]),b[a.uuid].dialog("open"))},edit_sim_slave_ini:function(a){var b=a.split("_")[0],c=a.split("_")[1];application.ws.remote("/teknon/services/sim_slave_ini/edit/",{},function(a){$(".main").html(a.data.dom.main),$("textarea").markItUp(mySettings),$(".main").hide(),$(".main").fadeIn("slow")})},cancel_edit_sim_slave_ini:function(){this.view_services()},save_edit_sim_slave_ini:function(a){var b=a.split("_")[0],c=a.split("_")[1],d=$("form").serializeObject();application.ws.remote("/teknon/services/"+kwargs.uuid+"/sim_slave_ini/save/",{data:d},function(a){$(".main").html(a.data.dom.main).hide().fadeIn(),$("#teknon-tabs").tabs()})},start_services:function(a){var b={},c;"uuid"in a?(b[a.uuid]="on",c=f([a.name])):(b=$(":checkbox:checked:visible").serializeObject(),c=f()),application.ws.remote("/data/teknon/services/start/",{},function(a){i18nButtons={},i18nButtons[gettext("Cancel")]=function(){$(this).dialog("close")},i18nButtons[gettext("Start")]=function(){var a=$(":checkbox:checked:visible").serializeObject();application.ws.remote("/data/teknon/services/switch/",{services:b,to_state:"on"},function(a){}),$(this).dialog("close")};var d=$(a.data.dom.dialog).dialog({resizable:!1,width:300,modal:!0,title:'<span class="ui-icon ui-icon-gear"></span><span>'+gettext("Please confirm")+"...</span>",open:function(a,b){$(".confirm-list").html(c)},buttons:i18nButtons,zIndex:1e6})})},stop_services:function(a){var b={},c;"uuid"in a?(b[a.uuid]="on",c=f([a.name])):(b=$(":checkbox:checked:visible").serializeObject(),c=f()),application.ws.remote("/data/teknon/services/stop/",{},function(a){i18nButtons={},i18nButtons[gettext("Cancel")]=function(){$(this).dialog("close")},i18nButtons[gettext("Stop")]=function(){var a=$(":checkbox:checked:visible").serializeObject();application.ws.remote("/data/teknon/services/switch/",{services:b,to_state:"off"},function(a){}),$(this).dialog("close")};var d=$(a.data.dom.dialog).dialog({resizable:!1,width:300,modal:!0,title:'<span class="ui-icon ui-icon-gear"></span><span>'+gettext("Please confirm")+"...</span>",open:function(a,b){$(".confirm-list").html(c)},buttons:i18nButtons,zIndex:1e6})})},kill_services:function(a){var b={},c;"uuid"in a?(b[a.uuid]="on",c=f([a.name])):(b=$(":checkbox:checked:visible").serializeObject(),c=f()),"uuid"in a?b[a.uuid]="on":b=$(":checkbox:checked:visible").serializeObject(),application.ws.remote("/data/teknon/services/kill/",{},function(a){i18nButtons={},i18nButtons[gettext("Cancel")]=function(){$(this).dialog("close")},i18nButtons[gettext("Kill")]=function(){var a=$(":checkbox:checked:visible").serializeObject();application.ws.remote("/data/teknon/services/switch/",{services:b,to_state:"kill"},function(a){}),$(this).dialog("close")};var d=$(a.data.dom.dialog).dialog({resizable:!1,width:300,modal:!0,title:'<span class="ui-icon ui-icon-gear"></span><span>'+gettext("Please confirm")+"...</span>",open:function(a,b){$(".confirm-list").html(c)},buttons:i18nButtons,zIndex:1e6})})}}}function g(){application.ws.method("^/data/teknon/services/state/update/$",function(a){$(document).trigger("SERVICE_CHANGED_STATE",[a.services]),typeof $("#teknon-services").val()!=="undefined"&&$.each(a.services,function(a,b){var c=$("#watchdog-status-"+b.uuid)[0],d=$("#service-status-"+b.uuid)[0],e=$("#console-status-"+b.uuid)[0];b.watchdog=="OFF"?($(c).removeClass("watchdog-on"),$(c).addClass("watchdog-off"),$.data(c,"state","ON")):($(c).removeClass("watchdog-off"),$(c).addClass("watchdog-on"),$.data(c,"state","OFF")),b.status=="OFF"?($(d).removeClass("service-on"),$(d).addClass("service-off"),$(c).addClass("action-icon-disabled"),$(e).addClass("action-icon-disabled"),$.data(d,"function","teknon.start_services")):($(d).removeClass("service-off"),$(d).addClass("service-on"),$(c).removeClass("action-icon-disabled"),$(e).removeClass("action-icon-disabled"),$.data(d,"function","teknon.stop_services"))})}),application.ws.method("^/data/teknon/$",function(a){application.functions.ui.transition(a.data.dom.main,$(".main")),$("#teknon-tabs").tabs()}),application.ws.method("^/data/teknon/services/(?<service_uuid>[^/]+)/console/update/$",function(a){filter_html=$("<div/>").text(a.output).html(),filter_lb=filter_html.replace(/\t/g,"&#09;").replace(/\r\n/g,"<br/>").replace(/\r/g,"<br/>").replace(/\n/g,"<br/>")+"<br/>",$("#console-lines-"+a.service_uuid).append(filter_lb+"<br/>"),$(".console-box").scrollTop($(".console-box > #console-lines-"+a.service_uuid).outerHeight()+1e7)})}function f(a){var b="<ul>";a==undefined?$.each($(":checkbox:checked:visible"),function(a,c){b=b+"<li>"+$(this).parent().next().text()+"</li>"}):$.each(a,function(a,c){b=b+"<li>"+c+"</li>"}),b+="</ul>";return b}var b={},c=[],d,e;return{init:function(a,b){h(),g(),i(),application.functions.teknon.route(a,b);return"teknon"},load:function(a,b){i(),application.functions.teknon.route(a,b)},clean_up:function(){j()}}})